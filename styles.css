// ë³´ì•ˆ ì»¨ì„¤íŒ… í¬íŠ¸í´ë¦¬ì˜¤ JavaScript
// ì‚¬ìš©ì ê²½í—˜ í–¥ìƒì„ ìœ„í•œ ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ë“¤

/**
 * DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰ë˜ëŠ” ë©”ì¸ í•¨ìˆ˜
 * ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì™€ ì´ˆê¸°í™” ì‘ì—…ì„ ìˆ˜í–‰
 */
document.addEventListener('DOMContentLoaded', function() {
    // ê° ê¸°ëŠ¥ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
    initNavbarScroll();
    initSmoothScrolling();
    initProjectFilter();
    initScrollAnimations();
    initTypingEffect();
    initTooltips();
    initContactForm();
});

/**
 * ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤í¬ë¡¤ íš¨ê³¼
 * ìŠ¤í¬ë¡¤ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì˜ íˆ¬ëª…ë„ì™€ í¬ê¸°ë¥¼ ì¡°ì •í•˜ì—¬ í˜„ëŒ€ì ì¸ ëŠë‚Œ ì œê³µ
 */
function initNavbarScroll() {
    const navbar = document.querySelector('.custom-navbar');
    let lastScrollTop = 0;
    
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // ìŠ¤í¬ë¡¤ ë°©í–¥ì— ë”°ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ ë°” í‘œì‹œ/ìˆ¨ê¹€
        if (scrollTop > lastScrollTop && scrollTop > 100) {
            // ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ë°” ìˆ¨ê¹€
            navbar.style.transform = 'translateY(-100%)';
        } else {
            // ìœ„ë¡œ ìŠ¤í¬ë¡¤ ì‹œ ë„¤ë¹„ê²Œì´ì…˜ ë°” í‘œì‹œ
            navbar.style.transform = 'translateY(0)';
        }
        
        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¥¸ ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì •
        if (scrollTop > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
        
        lastScrollTop = scrollTop;
        
        // í˜„ì¬ ì„¹ì…˜ì— ë”°ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
        updateActiveNavItem();
    });
}

/**
 * ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ë§ êµ¬í˜„
 * ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­ ì‹œ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
 */
function initSmoothScrolling() {
    const navLinks = document.querySelectorAll('.nav-link[href^="#"]');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                const navbarHeight = document.querySelector('.custom-navbar').offsetHeight;
                const targetPosition = targetSection.offsetTop - navbarHeight - 20;
                
                // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
                
                // ëª¨ë°”ì¼ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ë‹«ê¸°
                const navbarCollapse = document.querySelector('.navbar-collapse');
                if (navbarCollapse.classList.contains('show')) {
                    const navbarToggler = document.querySelector('.navbar-toggler');
                    navbarToggler.click();
                }
            }
        });
    });
}

/**
 * í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ì„¹ì…˜ì— ë”°ë¼ ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
 */
function updateActiveNavItem() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link[href^="#"]');
    const scrollPosition = window.scrollY + 100;
    
    sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.offsetHeight;
        const sectionId = section.getAttribute('id');
        
        if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            navLinks.forEach(link => link.classList.remove('active'));
            
            // í˜„ì¬ ì„¹ì…˜ì— í•´ë‹¹í•˜ëŠ” ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ì— active í´ë˜ìŠ¤ ì¶”ê°€
            const activeLink = document.querySelector(`.nav-link[href="#${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }
    });
}

/**
 * í”„ë¡œì íŠ¸ í•„í„°ë§ ê¸°ëŠ¥
 * í”„ë¡œì íŠ¸ ìœ í˜•ë³„ë¡œ í…Œì´ë¸” í–‰ì„ í•„í„°ë§í•˜ì—¬ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì‰½ê²Œ ì°¾ë„ë¡ ì§€ì›
 */
function initProjectFilter() {
    const filterButtons = document.querySelectorAll('.filter-buttons .btn');
    const projectRows = document.querySelectorAll('.project-row');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');
            
            // í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // í”„ë¡œì íŠ¸ í–‰ í•„í„°ë§ ì• ë‹ˆë©”ì´ì…˜
            projectRows.forEach((row, index) => {
                const categories = row.getAttribute('data-category').split(' ');
                
                if (filter === 'all' || categories.includes(filter)) {
                    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” í–‰ í‘œì‹œ
                    setTimeout(() => {
                        row.style.display = 'table-row';
                        row.classList.remove('hidden');
                        row.style.animation = `slideInLeft 0.5s ease-out ${index * 0.1}s both`;
                    }, index * 50);
                } else {
                    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ë§ì§€ ì•ŠëŠ” í–‰ ìˆ¨ê¹€
                    row.classList.add('hidden');
                    setTimeout(() => {
                        row.style.display = 'none';
                    }, 300);
                }
            });
        });
    });
}

/**
 * ìŠ¤í¬ë¡¤ ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜
 * ìš”ì†Œê°€ í™”ë©´ì— ë‚˜íƒ€ë‚  ë•Œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì ìš©
 */
function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    // Intersection Observerë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì†Œê°€ ë·°í¬íŠ¸ì— ë“¤ì–´ì˜¬ ë•Œ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const element = entry.target;
                
                // ê° ìš”ì†Œ íƒ€ì…ì— ë”°ë¥¸ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
                if (element.classList.contains('timeline-item')) {
                    element.style.animation = 'slideInLeft 0.8s ease-out forwards';
                } else if (element.classList.contains('contact-item')) {
                    element.style.animation = 'fadeInUp 0.6s ease-out forwards';
                } else if (element.classList.contains('stat-item')) {
                    element.style.animation = 'fadeInUp 0.5s ease-out forwards';
                    // ìˆ«ì ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                    animateCounter(element);
                }
                
                // ê´€ì°° ì¤‘ì§€ (í•œ ë²ˆë§Œ ì‹¤í–‰)
                observer.unobserve(element);
            }
        });
    }, observerOptions);
    
    // ì• ë‹ˆë©”ì´ì…˜ ëŒ€ìƒ ìš”ì†Œë“¤ì„ ê´€ì°° ì‹œì‘
    const animateElements = document.querySelectorAll('.timeline-item, .contact-item, .stat-item');
    animateElements.forEach(element => {
        observer.observe(element);
    });
}

/**
 * ìˆ«ì ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜
 * í†µê³„ ìˆ˜ì¹˜ê°€ 0ë¶€í„° ëª©í‘œê°’ê¹Œì§€ ì¦ê°€í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜
 */
function animateCounter(element) {
    const counterElement = element.querySelector('h3');
    if (!counterElement) return;
    
    const targetText = counterElement.textContent;
    const targetNumber = parseInt(targetText.replace(/[^0-9]/g, ''));
    const suffix = targetText.replace(/[0-9]/g, '');
    
    if (isNaN(targetNumber)) return;
    
    let currentNumber = 0;
    const increment = targetNumber / 50; // 50ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ì• ë‹ˆë©”ì´ì…˜
    const duration = 1500; // 1.5ì´ˆ ë™ì•ˆ ì• ë‹ˆë©”ì´ì…˜
    const stepTime = duration / 50;
    
    const timer = setInterval(() => {
        currentNumber += increment;
        
        if (currentNumber >= targetNumber) {
            counterElement.textContent = targetText;
            clearInterval(timer);
        } else {
            counterElement.textContent = Math.floor(currentNumber) + suffix;
        }
    }, stepTime);
}

/**
 * íƒ€ì´í•‘ íš¨ê³¼
 * íˆì–´ë¡œ ì„¹ì…˜ì˜ ì œëª©ì— íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì ìš©
 */
function initTypingEffect() {
    const titleElement = document.querySelector('.hero-content h1');
    if (!titleElement) return;
    
    const originalText = titleElement.textContent;
    titleElement.textContent = '';
    
    let index = 0;
    const typingSpeed = 100;
    
    function typeCharacter() {
        if (index < originalText.length) {
            titleElement.textContent += originalText.charAt(index);
            index++;
            setTimeout(typeCharacter, typingSpeed);
        } else {
            // íƒ€ì´í•‘ ì™„ë£Œ í›„ ì»¤ì„œ íš¨ê³¼ ì¶”ê°€
            titleElement.innerHTML += '<span class="typing-cursor">|</span>';
            
            // ì»¤ì„œ ê¹œë¹¡ì„ íš¨ê³¼
            setInterval(() => {
                const cursor = document.querySelector('.typing-cursor');
                if (cursor) {
                    cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0';
                }
            }, 500);
        }
    }
    
    // í˜ì´ì§€ ë¡œë“œ í›„ 1ì´ˆ ë’¤ì— íƒ€ì´í•‘ ì‹œì‘
    setTimeout(typeCharacter, 1000);
}

/**
 * íˆ´íŒ ê¸°ëŠ¥ ì´ˆê¸°í™”
 * Bootstrap íˆ´íŒì„ í™œì„±í™”í•˜ì—¬ ì¶”ê°€ ì •ë³´ ì œê³µ
 */
function initTooltips() {
    // Bootstrap 5 íˆ´íŒ ì´ˆê¸°í™”
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // í”„ë¡œì íŠ¸ í…Œì´ë¸” í–‰ì— íˆ´íŒ ì¶”ê°€
    const projectRows = document.querySelectorAll('.project-row td:nth-child(5)');
    projectRows.forEach(cell => {
        cell.setAttribute('data-bs-toggle', 'tooltip');
        cell.setAttribute('data-bs-placement', 'top');
        cell.setAttribute('title', 'í”„ë¡œì íŠ¸ ìƒì„¸ ì„±ê³¼ ì •ë³´');
    });
}

/**
 * ì—°ë½ì²˜ í¼ ê¸°ëŠ¥ (í–¥í›„ í™•ì¥ ê°€ëŠ¥)
 * ì—°ë½ì²˜ ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ ì—´ê¸° ë˜ëŠ” í´ë¦½ë³´ë“œ ë³µì‚¬
 */
function initContactForm() {
    const emailElement = document.querySelector('#contact .text-light-50');
    
    if (emailElement && emailElement.textContent.includes('@')) {
        emailElement.style.cursor = 'pointer';
        
        emailElement.addEventListener('click', function() {
            const email = 'jwc*******@naver.com'; // ì‹¤ì œ ì´ë©”ì¼ì€ ë§ˆìŠ¤í‚¹ëœ ìƒíƒœ
            
            // ì•Œë¦¼ ë©”ì‹œì§€ë¡œ ì•ˆë‚´
            showNotification('ì´ë©”ì¼ ë¬¸ì˜ë¥¼ ì›í•˜ì‹œë©´ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í†µí•´ ì—°ë½ì²˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!', 'info');
        });
    }
}

/**
 * ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
 * ì‚¬ìš©ì ì•¡ì…˜ì— ëŒ€í•œ í”¼ë“œë°± ì œê³µ
 */
function showNotification(message, type = 'info') {
    // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆë‹¤ë©´ ì œê±°
    const existingNotification = document.querySelector('.custom-notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // ìƒˆ ì•Œë¦¼ ìš”ì†Œ ìƒì„±
    const notification = document.createElement('div');
    notification.className = `custom-notification alert alert-${type === 'success' ? 'success' : 'info'}`;
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        padding: 15px;
        border-radius: 10px;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(10px);
        color: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì•Œë¦¼ í‘œì‹œ
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // 3ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}

/**
 * í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ (í–¥í›„ í™•ì¥ìš©)
 * í”„ë¡œì íŠ¸ ë§í¬ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ëª¨ë‹¬
 */
function initProjectModal() {
    const projectLinks = document.querySelectorAll('.project-row .btn-outline-primary');
    
    projectLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // ìƒìœ„ í–‰ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ì¶”ì¶œ
            const row = this.closest('.project-row');
            const projectName = row.querySelector('td:nth-child(2)').textContent;
            const client = row.querySelector('td:nth-child(3)').textContent;
            const achievement = row.querySelector('td:nth-child(5)').textContent;
            
            // ì„ì‹œ ì•Œë¦¼ìœ¼ë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ (ì‹¤ì œë¡œëŠ” ëª¨ë‹¬ êµ¬í˜„)
            showNotification(`${projectName} - ìœˆìŠ¤ ì •ë³´ë³´ì•ˆíŒ€ì—ì„œ ìˆ˜í–‰í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.`, 'info');
        });
    });
}

/**
 * ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
 * ìŠ¤í¬ë¡¤ì´ë‚˜ ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ì˜ ê³¼ë„í•œ í˜¸ì¶œì„ ë°©ì§€
 */
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

/**
 * ë°˜ì‘í˜• ë””ìì¸ ì§€ì›
 * í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë ˆì´ì•„ì›ƒ ì¡°ì •
 */
window.addEventListener('resize', debounce(function() {
    // ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ìë™ ë‹«ê¸°
    const navbarCollapse = document.querySelector('.navbar-collapse');
    if (window.innerWidth > 768 && navbarCollapse.classList.contains('show')) {
        const navbarToggler = document.querySelector('.navbar-toggler');
        navbarToggler.click();
    }
}, 250));

/**
 * ì ‘ê·¼ì„± ê°œì„ 
 * í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì§€ì› ë° ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„±
 */
document.addEventListener('keydown', function(e) {
    // ESC í‚¤ë¡œ ëª¨ë‹¬ì´ë‚˜ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
    if (e.key === 'Escape') {
        const notification = document.querySelector('.custom-notification');
        if (notification) {
            notification.remove();
        }
    }
    
    // íƒ­ í‚¤ ë„¤ë¹„ê²Œì´ì…˜ ê°œì„ 
    if (e.key === 'Tab') {
        document.body.classList.add('keyboard-navigation');
    }
});

// ë§ˆìš°ìŠ¤ ì‚¬ìš© ì‹œ í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ì œê±°
document.addEventListener('mousedown', function() {
    document.body.classList.remove('keyboard-navigation');
});

/**
 * ê°œë°œì ë„êµ¬ ê°ì§€ (ì„ íƒì‚¬í•­)
 * í¬íŠ¸í´ë¦¬ì˜¤ì˜ ë³´ì•ˆì  íŠ¹ì„±ì„ ê³ ë ¤í•œ ê°„ë‹¨í•œ ë³´ì•ˆ ì¡°ì¹˜
 */
function detectDevTools() {
    let devtools = {
        open: false,
        orientation: null
    };
    
    setInterval(() => {
        if (window.outerHeight - window.innerHeight > 160 || window.outerWidth - window.innerWidth > 160) {
            if (!devtools.open) {
                devtools.open = true;
                console.log('ğŸ”’ ì •ë³´ë³´ì•ˆ ì»¨ì„¤í„´íŠ¸ ìµœì§€ì›ì˜ í¬íŠ¸í´ë¦¬ì˜¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!');
                console.log('ğŸ’¼ ì›¹/ëª¨ë°”ì¼ ë³´ì•ˆ ì§„ë‹¨ ê´€ë ¨ ë¬¸ì˜ëŠ” ì–¸ì œë“  ì—°ë½í•´ì£¼ì„¸ìš”.');
                console.log('ğŸ›¡ï¸ ìœˆìŠ¤ ì •ë³´ë³´ì•ˆíŒ€ì—ì„œ 3ë…„ 5ê°œì›”ê°„ ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ì•˜ìŠµë‹ˆë‹¤.');
            }
        } else {
            devtools.open = false;
        }
    }, 500);
}

// ê°œë°œì ë„êµ¬ ê°ì§€ ì‹œì‘ (ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šì€ ìˆ˜ì¤€ìœ¼ë¡œ)
if (typeof window !== 'undefined') {
    detectDevTools();
}
